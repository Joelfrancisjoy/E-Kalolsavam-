# Render Deployment Fix Guide

## Problem
The Render deployment was failing with:
```
bash: line 1: cd: backend: No such file or directory
==> Build failed ðŸ˜ž
```

## Root Cause
The `render.yaml` file was located inside `backend/` directory and contained commands like `cd backend`, which failed because:
1. Render clones the entire repository
2. The YAML file should be in the **root** directory
3. The `rootDir` directive should specify where to run commands

## Solution Applied

### 1. Created `render.yaml` in Root Directory
Created a new `render.yaml` file at the repository root (`e:\test-project-app\render.yaml`) with:
- `rootDir: backend` - tells Render to run commands from backend directory
- Removed `cd backend` from build and start commands
- Proper environment variable configuration

### 2. Updated Configuration

**Old configuration** (incorrect):
```yaml
buildCommand: "cd backend && pip install -r requirements.txt && ..."
startCommand: "cd backend && gunicorn ..."
```

**New configuration** (correct):
```yaml
rootDir: backend
buildCommand: "pip install -r requirements.txt && python manage.py migrate && python manage.py collectstatic --noinput"
startCommand: "gunicorn e_kalolsavam.wsgi:application"
```

## Deployment Steps

### Step 1: Commit and Push Changes

```bash
# Navigate to your project
cd e:\test-project-app

# Add the new render.yaml
git add render.yaml

# Commit the changes
git commit -m "Fix Render deployment configuration"

# Push to GitHub
git push origin main
```

### Step 2: Set Up Render Service

1. **Go to [Render Dashboard](https://dashboard.render.com/)**
2. **Click "New +" â†’ "Web Service"**
3. **Connect your GitHub repository**: `Joelfrancisjoy/E-Kalolsavam-`
4. **Render will automatically detect** the `render.yaml` file

### Step 3: Configure Environment Variables

In Render dashboard, set these environment variables:

**Required Database Variables:**
```
DATABASE_NAME=your_database_name
DATABASE_USER=your_database_user
DATABASE_PASSWORD=your_database_password
DATABASE_HOST=your_database_host (from your DB provider)
DATABASE_PORT=3306
```

**Google OAuth Variables:**
```
SOCIAL_AUTH_GOOGLE_OAUTH2_KEY=286343152027-b5vl0g0s9no9qsd8iko6o86qq9ovfiei.apps.googleusercontent.com
SOCIAL_AUTH_GOOGLE_OAUTH2_SECRET=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
```

**Email Variables:**
```
EMAIL_HOST_USER=joelfrancisjoy@gmail.com
EMAIL_HOST_PASSWORD=tgig dcpn hruo jfii
```

**Other Variables:**
```
SECRET_KEY=(auto-generated by Render)
DEBUG=False
ALLOWED_HOSTS=kalolsavam-backend.onrender.com,your-custom-domain.com
FRONTEND_URL=https://your-frontend-url.onrender.com
```

### Step 4: Set Up Database

You need a MySQL database. Options:

#### Option A: Use Render's PostgreSQL (Recommended)
1. Create a PostgreSQL database in Render
2. Update `settings.py` to support PostgreSQL
3. Add `psycopg2-binary` to requirements.txt

#### Option B: Use External MySQL Provider
1. Use services like:
   - [PlanetScale](https://planetscale.com/)
   - [Railway](https://railway.app/)
   - [Amazon RDS](https://aws.amazon.com/rds/)
2. Get connection details and add to Render environment variables

### Step 5: Update Google OAuth Authorized Origins

Add your Render URL to Google Cloud Console:

1. Go to [Google Cloud Console](https://console.cloud.google.com/apis/credentials)
2. Edit your OAuth 2.0 Client ID
3. Add to **Authorized JavaScript origins**:
   ```
   https://kalolsavam-backend.onrender.com
   https://your-frontend-url.onrender.com
   ```
4. Add to **Authorized redirect URIs**:
   ```
   https://kalolsavam-backend.onrender.com/auth/complete/google-oauth2/
   https://your-frontend-url.onrender.com
   ```

### Step 6: Deploy

1. **Click "Create Web Service"** in Render
2. **Wait for deployment** (usually 5-10 minutes)
3. **Check logs** for any errors
4. **Visit your service URL**: `https://kalolsavam-backend.onrender.com`

## Verification Checklist

After deployment, verify:

- [ ] Service is running (green status in Render dashboard)
- [ ] `/admin` endpoint is accessible
- [ ] Database migrations completed successfully
- [ ] Static files are served correctly
- [ ] Google OAuth works (test login)
- [ ] CORS is configured for frontend

## Troubleshooting

### Build Still Failing?

**Check 1: Python Version**
Add `runtime.txt` in backend directory:
```
python-3.11.0
```

**Check 2: Dependencies**
Make sure `requirements.txt` has all packages:
```bash
cd backend
pip freeze > requirements.txt
git add requirements.txt
git commit -m "Update dependencies"
git push
```

**Check 3: Database Connection**
Test database connectivity in Render logs:
```python
# In Django shell on Render
python manage.py shell
>>> from django.db import connection
>>> connection.ensure_connection()
```

### Static Files Not Loading?

Add to `settings.py`:
```python
STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')
STATIC_URL = '/static/'

# For Render
STATICFILES_STORAGE = 'whitenoise.storage.CompressedManifestStaticFilesStorage'
```

Add `whitenoise` to `requirements.txt`:
```
whitenoise==6.5.0
```

Update `wsgi.py`:
```python
from whitenoise import WhiteNoise

application = get_wsgi_application()
application = WhiteNoise(application, root=os.path.join(BASE_DIR, 'staticfiles'))
```

### CORS Errors?

Update `settings.py`:
```python
CORS_ALLOWED_ORIGINS = [
    "https://your-frontend-url.onrender.com",
    "http://localhost:3000",  # for local dev
]
```

### Database Migration Errors?

Run migrations manually in Render:
1. Go to Render dashboard
2. Click on your service
3. Go to "Shell" tab
4. Run: `python manage.py migrate`

## Frontend Deployment

For the frontend, you'll also need to deploy to Render:

1. **Create separate Static Site** in Render
2. **Build command**: 
   ```
   cd frontend && npm install && npm run build
   ```
3. **Publish directory**: `frontend/build`
4. **Environment variables**:
   ```
   REACT_APP_API_URL=https://kalolsavam-backend.onrender.com
   REACT_APP_GOOGLE_CLIENT_ID=286343152027-b5vl0g0s9no9qsd8iko6o86qq9ovfiei.apps.googleusercontent.com
   ```

## Important Notes

### Free Tier Limitations
- Service spins down after 15 minutes of inactivity
- First request after spin down takes 30-60 seconds
- Database storage limited to 1GB

### Upgrade for Production
For production use, consider:
- Paid Render plan ($7/month+)
- Better database provider
- CDN for static files
- Custom domain

## Alternative: Using Render Blueprint

Instead of manual setup, you can use this `render.yaml`:

```yaml
services:
  - type: web
    name: kalolsavam-backend
    env: python
    region: oregon
    plan: free
    rootDir: backend
    buildCommand: "pip install -r requirements.txt && python manage.py collectstatic --no-input && python manage.py migrate"
    startCommand: "gunicorn e_kalolsavam.wsgi:application"
    healthCheckPath: /admin/
    envVars:
      - key: SECRET_KEY
        generateValue: true
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: WEB_CONCURRENCY
        value: 4

databases:
  - name: kalolsavam-db
    plan: free
```

## Success Indicators

You'll know deployment worked when:

1. âœ… Render shows "Live" status
2. âœ… Can access `https://kalolsavam-backend.onrender.com/admin`
3. âœ… No errors in Render logs
4. âœ… Database migrations completed
5. âœ… Static files loading
6. âœ… Google OAuth working

## Next Steps

1. Commit and push the `render.yaml` to GitHub
2. Set up Render service
3. Configure environment variables
4. Set up database
5. Deploy frontend separately
6. Update Google OAuth origins
7. Test complete application

---

**Status**: Configuration Fixed âœ…  
**Ready to Deploy**: Yes  
**Estimated Deploy Time**: 10-15 minutes
